language: python

matrix:
  include:
    - python: 3.7
      dist: xenial

services:
  - docker

install:
  - pip install -r requirements.txt
  - pip install -r dev-dependencies.txt

before_script:
  # - docker build --build-arg GIT_TAG=eada70e40f6e1f0c6927b717fb78c3c25c819b4a -t aergo/node ./docker
  - docker-compose -f ./docker/docker-compose.yml up&
  - docker_pid=$!
  - sleep 20

  - make deploy_test_bridge

  - make validator&
  - validator_pid=$!

  - make proposer&
  - proposer_pid=$!

script:
  - make tests

after_script: 
  - kill $proposer_pid
  - kill $validator_pid
  - kill $docker_pid
  - make clean